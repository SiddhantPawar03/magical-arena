<% layout('layout') %>

<div class="arena">
  <div class="players">
    <div class="player">
      <h2><%= player1.name %></h2>
      <p>Health: <span id="player1-health"><%= player1.health %></span></p>
      <p>Strength: <%= player1.strength %></p>
      <p>Attack: <%= player1.attack %></p>
      <button id="fight-button-player1" disabled>Fight</button>
    </div>
    <div class="player">
      <h2><%= player2.name %></h2>
      <p>Health: <span id="player2-health"><%= player2.health %></span></p>
      <p>Strength: <%= player2.strength %></p>
      <p>Attack: <%= player2.attack %></p>
      <button id="fight-button-player2">Fight</button>
    </div>
  </div>
  <button id="reset-button">Reset</button>
  <table id="logs" class="logs">
    <thead>
      <tr>
        <th>Attacker</th>
        <th>Defender</th>
        <th>Attack Roll</th>
        <th>Attack Damage</th>
        <th>Defend Roll</th>
        <th>Defend Damage</th>
        <th>Actual Damage</th>
        <th>Defender Health</th>
      </tr>
    </thead>
    <tbody>
      <!-- Log entries will be dynamically added here -->
    </tbody>
  </table>
</div>

<script>
  let player1 = { name: 'Player A', health: 50, strength: 5, attack: 10 };
  let player2 = { name: 'Player B', health: 100, strength: 10, attack: 5 };
  let currentTurn = 'player1';

  function rollDice() {
    return Math.floor(Math.random() * 6) + 1;
  }

  function fight(attacker, defender) {
    const attackRoll = rollDice();
    const defendRoll = rollDice();

    const attackDamage = attacker.attack * attackRoll;
    const defendDamage = defender.strength * defendRoll;

    const actualDamage = Math.max(0, attackDamage - defendDamage);

    defender.health = Math.max(0, defender.health - actualDamage);

    updateUI();
    logFight(attacker, defender, attackRoll, defendRoll, attackDamage, defendDamage, actualDamage);

    if (defender.health <= 0) {
      alert(`${attacker.name} wins!`);
      disableFightButtons();
    } else {
      toggleButtons();
    }
  }

  function updateUI() {
    document.getElementById('player1-health').textContent = player1.health;
    document.getElementById('player2-health').textContent = player2.health;
  }

  function logFight(attacker, defender, attackRoll, defendRoll, attackDamage, defendDamage, actualDamage) {
    const logsTable = document.getElementById('logs').getElementsByTagName('tbody')[0];
    const newRow = logsTable.insertRow();

    newRow.innerHTML = `
      <td>${attacker.name}</td>
      <td>${defender.name}</td>
      <td>${attackRoll}</td>
      <td>${attackDamage}</td>
      <td>${defendRoll}</td>
      <td>${defendDamage}</td>
      <td>${actualDamage}</td>
      <td>${defender.health}</td>
    `;
  }

  function resetGame() {
    player1 = { name: 'Player A', health: 50, strength: 5, attack: 10 };
    player2 = { name: 'Player B', health: 100, strength: 10, attack: 5 };
    document.getElementById('logs').getElementsByTagName('tbody')[0].innerHTML = '';
    currentTurn = 'player1';
    document.getElementById('fight-button-player1').disabled = false;
    document.getElementById('fight-button-player2').disabled = true;
    updateUI();
  }

  function toggleButtons() {
    if (currentTurn === 'player1') {
      document.getElementById('fight-button-player1').disabled = true;
      document.getElementById('fight-button-player2').disabled = false;
      currentTurn = 'player2';
    } else {
      document.getElementById('fight-button-player1').disabled = false;
      document.getElementById('fight-button-player2').disabled = true;
      currentTurn = 'player1';
    }
  }

  function disableFightButtons() {
    document.getElementById('fight-button-player1').disabled = true;
    document.getElementById('fight-button-player2').disabled = true;
  }

  document.getElementById('fight-button-player1').addEventListener('click', () => fight(player1, player2));
  document.getElementById('fight-button-player2').addEventListener('click', () => fight(player2, player1));
  document.getElementById('reset-button').addEventListener('click', resetGame);

  // Initialize buttons
  resetGame();
</script>

<link rel="stylesheet" type="text/css" href="/arena.css">
